/*! 
 Build based on admin-vue 
 Time : 1721439181000 */
import{v as e,a,C as t,o as s,c as o,b as l,d as r,w as i,g as p,t as n,j as d,l as u,E as c}from"./087AC4D233B64EB0index.3a42c3d0.js";import{E as h}from"./087AC4D233B64EB0scrollbar.f28f83ad.js";/* empty css                             *//* empty css                                 *//* empty css                                *//* empty css                               *//* empty css                               *//* empty css                              */import{e as m}from"./087AC4D233B64EB0api.309e4a80.js";import{E as f}from"./087AC4D233B64EB0index.3ccbca82.js";import{E as B}from"./087AC4D233B64EB0index.406c14ac.js";import"./087AC4D233B64EB0token.9ae252be.js";import"./087AC4D233B64EB0index.70cb6f72.js";import"./087AC4D233B64EB0index.680eed92.js";import"./087AC4D233B64EB0isEqual.e78056db.js";import"./087AC4D233B64EB0_Uint8Array.55422573.js";const v={class:"sticky top-0.5 z-10 flex space-x-2"},y={class:"tree-content"},E={class:"flex items-center justify-between w-full pr-1"},C={class:"max-w-[240px] break-all overflow-ellipsis overflow-hidden"},j=Object.assign({name:"Apis"},{__name:"apis",props:{row:{default:function(){return{}},type:Object}},setup(j,{expose:A}){const x=j,D=a({children:"children",label:"description"}),b=a(""),k=a(""),w=a([]),g=a([]),I=a("");(async()=>{const a=(await m()).data.apis;w.value=O(a);const t=await(s={authorityId:x.row.authorityId},e({url:"/casbin/getPolicyPathByAuthorityId",method:"post",data:s}));var s;I.value=x.row.authorityId,g.value=[],t.data.paths&&t.data.paths.forEach((e=>{g.value.push("p:"+e.path+"m:"+e.method)}))})();const _=a(!1),V=()=>{_.value=!0},O=e=>{const a={};e&&e.forEach((e=>{e.onlyId="p:"+e.path+"m:"+e.method,Object.prototype.hasOwnProperty.call(a,e.apiGroup)?a[e.apiGroup].push(e):Object.assign(a,{[e.apiGroup]:[e]})}));const t=[];for(const s in a){const e={ID:s,description:s+"组",children:a[s]};t.push(e)}return t},G=a(null),P=async()=>{const a=G.value.getCheckedNodes(!0);var t=[];a&&a.forEach((e=>{var a={path:e.path,method:e.method};t.push(a)}));var s;0===(await(s={authorityId:I.value,casbinInfos:t},e({url:"/casbin/updateCasbin",method:"post",data:s}))).code&&d({type:"success",message:"api设置成功"})};A({needConfirm:_,enterAndNext:()=>{P()}});const U=(e,a)=>{if(!b.value&&!k.value)return!0;let t,s;return t=!b.value||a.description&&a.description.includes(b.value),s=!k.value||a.path&&a.path.includes(k.value),t&&s};return t([b,k],(()=>{G.value.filter("")})),(e,a)=>{const t=u,d=c,m=f,j=B,A=h;return s(),o("div",null,[l("div",v,[r(t,{modelValue:b.value,"onUpdate:modelValue":a[0]||(a[0]=e=>b.value=e),class:"flex-1",placeholder:"筛选名字"},null,8,["modelValue"]),r(t,{modelValue:k.value,"onUpdate:modelValue":a[1]||(a[1]=e=>k.value=e),class:"flex-1",placeholder:"筛选路径"},null,8,["modelValue"]),r(d,{class:"float-right",type:"primary",onClick:P},{default:i((()=>[p("确 定")])),_:1})]),l("div",y,[r(A,null,{default:i((()=>[r(j,{ref_key:"apiTree",ref:G,data:w.value,"default-checked-keys":g.value,props:D.value,"default-expand-all":"","highlight-current":"","node-key":"onlyId","show-checkbox":"","filter-node-method":U,onCheck:V},{default:i((({node:e,data:a})=>[l("div",E,[l("span",null,n(a.description),1),r(m,{content:a.path},{default:i((()=>[l("span",C,n(a.path),1)])),_:2},1032,["content"])])])),_:1},8,["data","default-checked-keys","props"])])),_:1})])])}}});export{j as default};
