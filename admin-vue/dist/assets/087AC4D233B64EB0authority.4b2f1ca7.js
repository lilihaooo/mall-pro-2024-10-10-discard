/*! 
 Build based on admin-vue 
 Time : 1721439181000 */
import{a,o as e,c as t,d as l,b as o,w as r,g as i,x as u,dd as d,t as s,h as n,e as m,ar as p,j as y,E as h,S as c,l as v}from"./087AC4D233B64EB0index.3a42c3d0.js";import{E as B,a as C}from"./087AC4D233B64EB0tab-pane.dd89ee37.js";import{E as f}from"./087AC4D233B64EB0drawer.53419836.js";import"./087AC4D233B64EB0overlay.b3cb4214.js";import{a as A,E}from"./087AC4D233B64EB0form-item.3185fbfe.js";/* empty css                              */import{E as I}from"./087AC4D233B64EB0radio.7d9fa41b.js";/* empty css                               *//* empty css                            *//* empty css                                 */import"./087AC4D233B64EB0scrollbar.f28f83ad.js";import{E as b,a as j}from"./087AC4D233B64EB0table-column.d8728fc7.js";/* empty css                                *//* empty css                               */import{g as D,d as g,c as w,u as k,a as _}from"./087AC4D233B64EB0authority.24d33232.js";import x from"./087AC4D233B64EB0menus.ebfeece9.js";import N from"./087AC4D233B64EB0apis.d7e004de.js";import V from"./087AC4D233B64EB0datas.a5d33719.js";import{W as U}from"./087AC4D233B64EB0warningBar.7ffbb10e.js";import{t as q}from"./087AC4D233B64EB0doc.46160848.js";import"./087AC4D233B64EB0strings.8c6e2eb6.js";import"./087AC4D233B64EB0index.c4687db7.js";import"./087AC4D233B64EB0index.3ccbca82.js";import"./087AC4D233B64EB0castArray.cde6f052.js";import"./087AC4D233B64EB0_baseClone.00b8bfb0.js";import"./087AC4D233B64EB0_Uint8Array.55422573.js";import"./087AC4D233B64EB0_initCloneObject.f657614f.js";import"./087AC4D233B64EB0index.680eed92.js";import"./087AC4D233B64EB0isEqual.e78056db.js";import"./087AC4D233B64EB0arrays.2c626d3b.js";import"./087AC4D233B64EB0cloneDeep.9f04767c.js";import"./087AC4D233B64EB0index.83c0fa4e.js";import"./087AC4D233B64EB0index.f44b2100.js";import"./087AC4D233B64EB0debounce.c5d6bbb5.js";import"./087AC4D233B64EB0_baseIteratee.5313185f.js";import"./087AC4D233B64EB0dialog.8a425e00.js";/* empty css                             */import"./087AC4D233B64EB0authorityBtn.0746770a.js";import"./087AC4D233B64EB0index.406c14ac.js";import"./087AC4D233B64EB0token.9ae252be.js";import"./087AC4D233B64EB0index.70cb6f72.js";import"./087AC4D233B64EB0api.309e4a80.js";const S={class:"authority"},T={class:"gva-table-box"},z={class:"gva-btn-list"},F={class:"flex justify-between items-center"},O={class:"text-lg"},R=Object.assign({name:"Authority"},{__name:"authority",setup(R){const P=a([{authorityId:0,authorityName:"根角色"}]),Q=a(!1),G=a("add"),W=a({}),Z=a("新增角色"),$=a(!1),H=a(!1),J=a({}),K=a({authorityId:0,authorityName:"",parentId:0}),L=a({authorityId:[{required:!0,message:"请输入角色ID",trigger:"blur"},{validator:(a,e,t)=>/^[0-9]*[1-9][0-9]*$/.test(e)?t():t(new Error("请输入正整数")),trigger:"blur",message:"必须为正整数"}],authorityName:[{required:!0,message:"请输入角色名",trigger:"blur"}],parentId:[{required:!0,message:"请选择父角色",trigger:"blur"}]}),M=a(1),X=a(0),Y=a(999),aa=a([]),ea=a({}),ta=async()=>{const a=await D({page:M.value,pageSize:Y.value,...ea.value});0===a.code&&(aa.value=a.data.list,X.value=a.data.total,M.value=a.data.page,Y.value=a.data.pageSize)};ta();const la=(a,e)=>{W.value[a]=e},oa=a(null),ra=a(null),ia=a(null),ua=(a,e)=>{const t=[oa,ra,ia];e&&t[e].value.needConfirm&&(t[e].value.enterAndNext(),t[e].value.needConfirm=!1)},da=a(null),sa=()=>{da.value&&da.value.resetFields(),K.value={authorityId:0,authorityName:"",parentId:0}},na=()=>{sa(),$.value=!1,H.value=!1},ma=()=>{da.value.validate((async a=>{if(a){switch(K.value.authorityId=Number(K.value.authorityId),G.value){case"add":0===(await _(K.value)).code&&(y({type:"success",message:"添加成功!"}),ta(),na());break;case"edit":0===(await k(K.value)).code&&(y({type:"success",message:"添加成功!"}),ta(),na());break;case"copy":{const a={authority:{authorityId:0,authorityName:"",datauthorityId:[],parentId:0},oldAuthorityId:0};a.authority.authorityId=K.value.authorityId,a.authority.authorityName=K.value.authorityName,a.authority.parentId=K.value.parentId,a.authority.dataAuthorityId=J.value.dataAuthorityId,a.oldAuthorityId=J.value.authorityId;0===(await w(a)).code&&(y({type:"success",message:"复制成功！"}),ta())}}sa(),$.value=!1}}))},pa=()=>{P.value=[{authorityId:0,authorityName:"根角色"}],ya(aa.value,P.value,!1)},ya=(a,e,t)=>{a&&a.forEach((a=>{if(a.children&&a.children.length){const l={authorityId:a.authorityId,authorityName:a.authorityName,disabled:t||a.authorityId===K.value.authorityId,children:[]};ya(a.children,l.children,t||a.authorityId===K.value.authorityId),e.push(l)}else{const l={authorityId:a.authorityId,authorityName:a.authorityName,disabled:t||a.authorityId===K.value.authorityId};e.push(l)}}))},ha=a=>{sa(),Z.value="新增角色",G.value="add",K.value.parentId=a,pa(),$.value=!0};return(a,D)=>{const w=h,k=c,_=b,R=j,H=I,X=A,Y=v,ea=E,sa=f,ya=B,ca=C;return e(),t("div",S,[l(U,{title:"注：右上角头像下拉可切换角色"}),o("div",T,[o("div",z,[l(w,{type:"primary",icon:"plus",onClick:D[0]||(D[0]=a=>ha(0))},{default:r((()=>[i("新增角色")])),_:1}),l(k,{class:"cursor-pointer",onClick:D[1]||(D[1]=a=>u(q)("https://www.bilibili.com/video/BV1kv4y1g7nT?p=8&vd_source=f2640257c21e3b547a790461ed94875e"))},{default:r((()=>[l(u(d))])),_:1})]),l(R,{data:aa.value,"tree-props":{children:"children",hasChildren:"hasChildren"},"row-key":"authorityId",style:{width:"100%"}},{default:r((()=>[l(_,{label:"角色ID","min-width":"180",prop:"authorityId"}),l(_,{align:"left",label:"角色名称","min-width":"180",prop:"authorityName"}),l(_,{align:"left",label:"操作",width:"460"},{default:r((a=>[l(w,{icon:"setting",type:"primary",link:"",onClick:e=>{return t=a.row,Q.value=!0,void(W.value=t);var t}},{default:r((()=>[i("设置权限")])),_:2},1032,["onClick"]),l(w,{icon:"plus",type:"primary",link:"",onClick:e=>ha(a.row.authorityId)},{default:r((()=>[i("新增子角色")])),_:2},1032,["onClick"]),l(w,{icon:"copy-document",type:"primary",link:"",onClick:e=>(a=>{pa(),Z.value="拷贝角色",G.value="copy";for(const e in K.value)K.value[e]=a[e];J.value=a,$.value=!0})(a.row)},{default:r((()=>[i("拷贝")])),_:2},1032,["onClick"]),l(w,{icon:"edit",type:"primary",link:"",onClick:e=>(a=>{pa(),Z.value="编辑角色",G.value="edit";for(const e in K.value)K.value[e]=a[e];pa(),da.value&&da.value.clearValidate(),$.value=!0})(a.row)},{default:r((()=>[i("编辑")])),_:2},1032,["onClick"]),l(w,{icon:"delete",type:"primary",link:"",onClick:e=>{return t=a.row,void p.confirm("此操作将永久删除该角色, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{0===(await g({authorityId:t.authorityId})).code&&(y({type:"success",message:"删除成功!"}),1===aa.value.length&&M.value>1&&M.value--,ta())})).catch((()=>{y({type:"info",message:"已取消删除"})}));var t}},{default:r((()=>[i("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])]),l(sa,{modelValue:$.value,"onUpdate:modelValue":D[5]||(D[5]=a=>$.value=a),"show-close":!1},{header:r((()=>[o("div",F,[o("span",O,s(Z.value),1),o("div",null,[l(w,{onClick:na},{default:r((()=>[i("取 消")])),_:1}),l(w,{type:"primary",onClick:ma},{default:r((()=>[i("确 定")])),_:1})])])])),default:r((()=>[l(ea,{ref_key:"authorityForm",ref:da,model:K.value,rules:L.value,"label-width":"80px"},{default:r((()=>[l(X,{label:"父级角色",prop:"parentId"},{default:r((()=>[l(H,{modelValue:K.value.parentId,"onUpdate:modelValue":D[2]||(D[2]=a=>K.value.parentId=a),style:{width:"100%"},disabled:"add"===G.value,options:P.value,props:{checkStrictly:!0,label:"authorityName",value:"authorityId",disabled:"disabled",emitPath:!1},"show-all-levels":!1,filterable:""},null,8,["modelValue","disabled","options"])])),_:1}),l(X,{label:"角色ID",prop:"authorityId"},{default:r((()=>[l(Y,{modelValue:K.value.authorityId,"onUpdate:modelValue":D[3]||(D[3]=a=>K.value.authorityId=a),disabled:"edit"===G.value,autocomplete:"off",maxlength:"15"},null,8,["modelValue","disabled"])])),_:1}),l(X,{label:"角色姓名",prop:"authorityName"},{default:r((()=>[l(Y,{modelValue:K.value.authorityName,"onUpdate:modelValue":D[4]||(D[4]=a=>K.value.authorityName=a),autocomplete:"off"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue"]),Q.value?(e(),n(sa,{key:0,modelValue:Q.value,"onUpdate:modelValue":D[6]||(D[6]=a=>Q.value=a),"with-header":!1,size:"40%",title:"角色配置"},{default:r((()=>[l(ca,{"before-leave":ua,type:"border-card"},{default:r((()=>[l(ya,{label:"角色菜单"},{default:r((()=>[l(x,{ref_key:"menus",ref:oa,row:W.value,onChangeRow:la},null,8,["row"])])),_:1}),l(ya,{label:"角色api"},{default:r((()=>[l(N,{ref_key:"apis",ref:ra,row:W.value,onChangeRow:la},null,8,["row"])])),_:1}),l(ya,{label:"资源权限"},{default:r((()=>[l(V,{ref_key:"datas",ref:ia,authority:aa.value,row:W.value,onChangeRow:la},null,8,["authority","row"])])),_:1})])),_:1})])),_:1},8,["modelValue"])):m("",!0)])}}});export{R as default};
